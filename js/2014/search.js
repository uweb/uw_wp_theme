"use strict";UW.Search=Backbone.View.extend({searchFeatures:{uw:"uw",site:"site"},searchbar:'<div class="container no-height" role="search"><div class="center-block uw-search-wrapper"><form class="uw-search" action="<%= UW.baseUrl %>"><div class="search-form-wrapper"><label class="screen-reader" for="uw-search-bar">Enter search text</label><input id="uw-search-bar" type="search" name="s" value="" autocomplete="off" placeholder="Search" /></div><select id="mobile-search-select" class="visible-xs" aria-label="Search scope"><option value="uw" selected>All the UW</option><option value="site">Current site</option></select><input type="submit" value="search" class="search" tabindex="0"/><fieldset style="margin: 0; padding: 0; border: 1px solid #ffffff;"><legend id="uw-search-label">Search scope</legend><div id="search-labels" class="labels hidden-xs"><label class="radio"><input class="radiobtn" type="radio" name="search" value="uw" data-toggle="radio" checked />All the UW</label><label class="radio"><input class="radiobtn" type="radio" name="search" value="site" data-toggle="radio" />Current site</label></div></fieldset></form></div></div>',defaults:{},events:{"click label.radio":"toggleSearchFeature","change select":"toggleSearchFeature","click .search":"submitForm","submit form":"submitSearch",keydown:"handleKeyDown","focus input":"skipToContentIfHidden"},initialize:function(e){this.settings=_.extend({},this.defaults,this.$el.data(),e),this.render(),this.toggle=new UW.SearchToggle,this.toggle.on("open",this.toggleBlur,this),this.searchFeature=this.$el.find(":radio:checked").val()},render:function(){this.$el.html(_.template(this.searchbar)(this.settings))},toggleBlur:function(){this.toggle.settings.isOpen?(this.$el.find("#uw-search-bar").focus(),this.$el.attr("aria-hidden","false").attr("role","search")):this.$el.attr("aria-hidden","true").removeAttr("role")},handleKeyDown:function(e){switch(e.keyCode){case UW.KEYCODES.TAB:return $(e.target)[0]!=$("input.search")[0]||$(e)[0].shiftKey||$("#search-labels").addClass("focused"),$(e.target)[0]!=$("input.search")[0]&&$("#search-labels").hasClass("focused")&&$("#search-labels").removeClass("focused"),!($(e.target)[0]==$("input.radiobtn")[0]&&!$(e)[0].shiftKey)||(this.toggle.$el.focus(),!1);case UW.KEYCODES.ESC:return e.stopPropagation(),this.toggle.toggleSearchBar(),this.toggle.$el.focus(),!1;default:return!0}},toggleSearchFeature:function(e){if("none"==$("#mobile-search-select.visible-xs").css("display")){var t=$(e.currentTarget).find("input").val();this.searchFeature=t}else{var s=$(e.currentTarget).val();this.searchFeature=s}},skipToContentIfHidden:function(){this.toggle.settings.isOpen||$("#primary").focus()},submitSearch:function(e){switch(this.$el.find("input.radiobtn").attr("disabled","disabled"),this.searchFeature){case this.searchFeatures.uw:return this.$el.find("#uw-search-bar").attr("name","q"),this.$el.find("form").attr("action",Backbone.history.location.protocol+"//uw.edu/search/"),!0;case this.searchFeatures.site:return!0;default:return!1}},submitForm:function(){return this.$el.find("form").submit(),!1}});