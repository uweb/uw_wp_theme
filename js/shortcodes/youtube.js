"use strict";UW.YouTube={},UW.YouTube.Collection=Backbone.Collection.extend({initialize:function(i){_(this).bindAll("parse"),this.el=i.el,this.$el=jQuery(this.el),this.youtube_id=this.$el.data("uw-youtube"),this.setup_for_type(),this.make_view(),this.fetch({success:this.view.onDataReady})},setup_for_type:function(i){if(this.type=this.$el.data("uw-youtube-type"),this.modest=this.$el.data("modest"),this.resolution=this.$el.data("resolution"),"playlist"==this.type){this.max_results=20;var t=parseInt(this.$el.data("max-results"),10);0<t&&(this.max_results=t),this.model=UW.YouTube.PlaylistItem,this.url="https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId="+this.youtube_id+"&key=AIzaSyApmhFr5oa8bmKPcpN7bm-h0mekjkUVypU&maxResults="+this.max_results}else"single"==this.type&&(this.model=UW.YouTube.Video,this.url="https://www.googleapis.com/youtube/v3/videos?part=snippet&id="+this.youtube_id+"&key=AIzaSyApmhFr5oa8bmKPcpN7bm-h0mekjkUVypU")},parse:function(i){var t=this.type,e=this.youtube_id;return _(i.items).map(function(i){return"single"==t&&(i.snippet.resourceId={videoId:e}),i.snippet})},make_view:function(i){this.view=new UW.YouTube.CollectionView({collection:this})}}),UW.YouTube.CollectionView=Backbone.View.extend({template:"<div class='nc-video-player' role='region' aria-label='video' tabindex=-1><div class='tube-wrapper'></div></div>",playlist_section:"<div class='vidSmall'><div class='scrollbar'><div class='track'><div class='thumb'><div class='end'></div></div></div></div><div class='viewport'><div class='vidContent overview'><ul></ul></div></div></div>",events:{"click button":"preview_clicked"},initialize:function(){_(this).bindAll("onReady","onDataReady","onStateChange","preview_clicked","resized"),this.player_ready=!1,this.data_ready=!1,this.wrap(),this.add_iFrame_api(),"playlist"==this.collection.type&&(this.$el.addClass("playlist"),this.add_playlist_section(),this.scrollbar_visible=!1,jQuery(window).resize(this.resized))},resized:function(){var i=this.$vidSmall.find(".viewport").width();i!=this.$viewport_width&&(this.$viewport_width=i,this.showTinyScrollbar())},wrap:function(){this.collection.$el.wrap(jQuery(this.template)),this.$el=this.collection.$el.parents(".nc-video-player"),this.el=this.$el[0]},add_iFrame_api:function(){0===UW.$body.find("script#iFrame").length&&(UW.$body.append('<script id="iFrame" title="YouTube video player" src="//www.youtube.com/player_api" type="text/javascript"><\/script>'),this.add_iFrame_function())},add_iFrame_function:function(){window.onYouTubeIframeAPIReady=function(){for(var i=0,t=UW.youtube.length;i<t;i++){var e=UW.youtube[i],s={};s=e.modest?{rel:0,controls:0,modestbranding:1}:{rel:0},e.view.uwplayer=new YT.Player(e.$el.attr("id"),{videoId:"",playerVars:s,events:{onReady:e.view.onReady,onStateChange:e.view.onStateChange}})}}},add_playlist_section:function(){this.$el.append(this.playlist_section),this.$vidSmall=this.$el.find(".vidSmall"),this.$vidContent=this.$el.find(".vidContent"),this.scrollbar_visible=!1},onReady:function(){this.player_ready=!0,this.check_all_ready()},onDataReady:function(){this.data_ready=!0,"playlist"==this.collection.type&&(this.$vidContent_width=135*this.collection.models.length,this.$vidContent.width(this.$vidContent_width+"px"),this.$viewport_width=this.$vidSmall.find(".viewport").width(),this.showTinyScrollbar()),this.check_all_ready()},showTinyScrollbar:function(){this.$vidContent_width>this.$viewport_width?this.scrollbar_visible||(this.$vidSmall.find(".scrollbar").show(),this.$vidSmall.tinyscrollbar({axis:"x"}),this.scrollbar_visible=!0):this.scrollbar_visible&&(this.$vidSmall.find(".scrollbar").removeAttr("style"),this.scrollbar_visible=!1)},check_all_ready:function(){this.data_ready&&this.player_ready&&this.play(this.collection.models[0].get("resourceId").videoId)},onStateChange:function(i){if(this.is_playlist&&0===i.data){var t=this.$vidContent.find(".vid-active").attr("id"),e=this.video_ids.indexOf(t);e<this.video_ids.length-1?this.play(this.video_ids[e+1]):this.play(this.video_ids[0])}},play:function(i,t){if((t=t||!1)?(this.uwplayer.loadVideoById(i),this.$el.focus()):this.uwplayer.cueVideoById(i),"playlist"==this.collection.type){this.$el.find("a.vid-active").removeClass("vid-active");var e=jQuery("#"+i);if(e.addClass("vid-active"),this.$el.attr("aria-label","video: "+e.data("title")),this.scrollbar_visible){var s=e.position().left;this.$vidContent_width-s<this.$viewport_width&&(s=this.$vidContent_width-this.$viewport_width),this.$vidContent.animate({left:-s},500),this.$vidSmall.data("plugin_tinyscrollbar").update(s)}}},preview_clicked:function(i){this.play(i.currentTarget.id,!0)}}),UW.YouTube.Video=Backbone.Model.extend({initialize:function(){this.get("resourceId")&&(this.view=new UW.YouTube.VideoView({model:this}))}}),UW.YouTube.VideoView=Backbone.View.extend({initialize:function(){this.render()},render:function(){this.model.collection.view.$el.attr("aria-label","video: "+this.model.get("title"))}}),UW.YouTube.PlaylistItem=Backbone.Model.extend({initialize:function(){this.get("resourceId")&&(this.view=new UW.YouTube.PlaylistItemView({model:this}))}}),UW.YouTube.PlaylistItemView=Backbone.View.extend({template:"<li><button id='<%= resourceId.videoId %>' data-title='<%= title %>' class='video'><img src='<%= thumbnails.default.url %>'/><div class='text'><p class='title'><%= title %></p></div></button></li>",initialize:function(){this.$el=this.model.collection.view.$vidContent.find("ul"),this.render()},render:function(){var i=this.model.toJSON(),t=_.template(this.template)(i);this.$el.append(t)}});